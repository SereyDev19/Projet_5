{% extends 'layout.twig' %}

{% block content %}
    <header class="row col-sm-12">
        <div>
            <img id="logo" src="images/LOGOreportmeWHITE.png">
        </div>
        <div class="page-header">
            <h1>Synthèse : {{ DBaccount.account_name }}</h1>
        </div>
        <div>
            <div class="btn-group dropdown">
                <button type="button" class="user btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    {{ user_name }}
                </button>
                <div class="dropdown-menu">
                    {% if userSession.levelAccess !=0 %}
                        <a class="dropdown-item" href="admin.php?action=manageAccess">
                            Gérer les accès
                        </a>
                    {% endif %}
                    <a class="dropdown-item" href="admin.php?action=globalreport">
                        Tableau de bord
                    </a>
                    <a class="dropdown-item" href="admin.php?action=profile">
                        Profil
                    </a>
                    <a class="dropdown-item" href="admin.php?action=logout">
                        <i class="fas fa-power-off"></i>Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </header>
    <div id="dashboard" class="container">

        <div class="row col-sm-12">
            <a class="" href="index.php"><i class="fas fa-arrow-left"></i>Retour vers l'accueil</a>
        </div>
        <div class="btn-group row col-sm-12">
            <div class="btn-group dropdown">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    <i class="fas fa-home"></i>Aller à
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="admin.php?action=globalreport">
                        Tous les comptes
                    </a>
                    <a class="dropdown-item" href="admin.php?action=detailedReport&amp;account_id={{ accountId }}">
                        Rapport détaillé
                    </a>
                </div>
            </div>
        </div>
        {% if userSession.levelAccess !=0 %}
            <button type="button" class="btn btn-info">
                <a href="admin.php?action=updateAccountData&amp;account_id={{ accountId }}">
                    <i class="fas fa-sync-alt"></i>Mise à jour des données
                </a>
            </button>
            <button type="button" class="btn btn-info">
                <a href="admin.php?action=updateAccountDataWithDates&amp;account_id={{ accountId }}">
                    <i class="fas fa-sync-alt"></i>Mise à jour des données avec dates
                </a>
            </button>
        {% endif %}

        <div class="btn-group row col-sm-12 sort">
            <div class="btn-group dropdown col-sm-2 offset-sm-9">
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=date&amp;order=ASC">
                        Date <i class="fas fa-sort-up"></i>
                    </a>
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=date&amp;order=DESC">
                        Date <i class="fas fa-sort-down"></i>
                    </a>
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=postid&amp;order=ASC">
                        Article <i class="fas fa-sort-up"></i>
                    </a>
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=postid&amp;order=DESC">
                        Article <i class="fas fa-sort-down"></i>
                    </a>
                </div>
            </div>
        </div>
        <section class="col-xl-6">
            <div class="panel panel-primary">
                <h2>Rapport (30 derniers jours par défaut)</h2>
                <p>Exporter</p>
                <a class="" href="admin.php?action=exportAccountData&amp;account_id={{ accountId }}"><i
                            class="fas fa-file-csv"></i></a>
                <a href="admin.php?action=exportAccountData&amp;account_id={{ accountId }}"><i
                            class="far fa-file-pdf"></i></a>
                <table class="container table table-striped table-condensed">
                    <thead>
                    <tr>
                        <th>
                            <i class="far fa-calendar-alt"></i>
                            <span class="responsive_title">Dépense pub Facebook</span>
                            <button type="button" class="btn btn-secondary" data-toggle="tooltip" data-placement="top"
                                    title="Tooltip on top">
                                Tooltip on top
                            </button>
                        </th>

                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Nombre de leads ou de ventes Facebook</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">Coût par lead ou retour sur dépense pub Facebook</span>
                        </th>

                    </tr>
                    </thead>
                    <tr>
                        <td>
                            <span id="plotSpend" class="exportButton">{{ DBaccount.spend30d }} €</span>
                        </td>
                        <td>
                            <span id="plotLead" class="exportButton">{{ DBaccount.leads30d }}</span>
                        </td>
                        <td>
                            <span id="plotCostPerLead" class="exportButton">{{ DBaccount.cost_per_lead30d }}€</span>
                        </td>
                    </tr>

                </table>
            </div>

        </section>

        <section class="col-xl-12">
            <div class="panel panel-primary">
                <div id="plotarea" class="chart-container" style="position: relative; width:850px">

                </div>
            </div>
        </section>
    </div>
    <footer class="row col-sm-12">
    </footer>
    </div>
{% endblock %}

{% block scripts %}
    {% if datesSpend and valuesSpend %}
        <script>
            {% if SERVER_NAME == 'sc19dev.fr' %}
            var url = "http://{{ SERVER_NAME }}/Projet_5_Test/admin.php?action=testAJAX&account_id={{ accountId }}"
            {% else %}
            var url = "http://{{ SERVER_NAME }}/admin.php?action=testAJAX&account_id={{ accountId }}"
            {% endif %}

            var app = new App(url);
            app.init();
            app.plotSpend('plotSpend');
            app.plotLead('plotLead');
            app.plotCostPerLead('plotCostPerLead');
        </script>
    {% endif %}

{% endblock %}
