{% extends 'layout.twig' %}

{% block content %}
    <header class="row col-sm-12">
        <div>
            <img id="logo" src="images/LOGOreportmeWHITE.png">
        </div>
        <div class="page-header">
            <h1>Rapport détaillé de : {{ account[0].account_name }}</h1>
        </div>
        <div>
            <div class="btn-group dropdown">
                <button type="button" class="user btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    {{ user_name }}
                </button>
                <div class="dropdown-menu">
                    {% if userSession.levelAccess !=0 %}
                        <a class="dropdown-item" href="admin.php?action=manageAccess">
                            Gérer les accès
                        </a>
                    {% endif %}
                    <a class="dropdown-item" href="admin.php?action=globalreport">
                        Tableau de bord
                    </a>
                    <a class="dropdown-item" href="admin.php">
                        Profil
                    </a>
                    <a class="dropdown-item" href="admin.php?action=logout">
                        <i class="fas fa-power-off"></i>Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </header>
    <div id="dashboard" class="container">
        <div class="row col-sm-12">
            <a class="" href="index.php"><i class="fas fa-arrow-left"></i>Retour vers l'accueil</a>
        </div>
        <div class="btn-group row col-sm-12">
            <div class="btn-group dropdown">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    <i class="fas fa-home"></i>Aller à
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="admin.php?action=globalreport">
                        Tous les comptes
                    </a>
                    <a class="dropdown-item" href="admin.php?action=reportAccount&amp;account_id=<?= $accountId; ?>">
                        Rapport synthétique
                    </a>
                </div>
            </div>
        </div>
        {% if userSession.levelAccess !=0 %}
            <button type="button" class="btn btn-info">
                <a href="admin.php?action=updateData&amp;account_id=<?= $accountId; ?>">
                    <i class="fas fa-sync-alt"></i>Mise à jour des données
                </a>
            </button>
        {% endif %}

        <?php endif; ?>

        <div class="btn-group row col-sm-12 sort">
            <div class="btn-group dropdown col-sm-2 offset-sm-9">
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=date&amp;order=ASC">
                        Date <i class="fas fa-sort-up"></i>
                    </a>
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=date&amp;order=DESC">
                        Date <i class="fas fa-sort-down"></i>
                    </a>
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=postid&amp;order=ASC">
                        Article <i class="fas fa-sort-up"></i>
                    </a>
                    <a class="dropdown-item" href="admin.php?action=sortPosts&amp;sort=postid&amp;order=DESC">
                        Article <i class="fas fa-sort-down"></i>
                    </a>
                </div>
            </div>
        </div>
        <section class="col-xl-12">
            <div class="panel panel-primary">
                <h2>Rapport sur les trentes derniers jours</h2>

                <table class="adsets container table table-striped table-condensed">
                    <thead>
                    <tr>
                        <th>
                            <i class="far fa-calendar-alt"></i>
                            <span class="responsive_title">Nom de l'ensemble de publicités</span>
                        </th>

                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Dépenses pub</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">CPM</span>
                        </th>
                        <th>
                            <i class="far fa-calendar-alt"></i>
                            <span class="responsive_title">Nombre de clics</span>
                        </th>

                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Coût par clic</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">Résultats</span>
                        </th>
                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Coût par résultat</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">Taux d'achat</span>
                        </th>
                    </tr>
                    </thead>
                    {% for data in adSets %}
                        <tr id="{{ data.adset_name }}">
                            <td>
                                {{ data.adset_name }}
                            </td>
                            <td>
                                {{ data.spend30d }} €
                            </td>
                            <td>
                                {{ data.cpm30d }}
                            </td>
                            <td>
                                {{ data.clicks30d }}
                            </td>
                            <td>
                                {{ data.cost_per_click30d }}
                            </td>
                            <td>
                                {{ data.leads30d }} <br/>
                                {{ data.optimization_goal }}
                            </td>
                            <td>
                                {{ data.cost_per_lead30d }}
                            </td>
                            <td>
                                {{ data.sell_rate30d }}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
                <div class="btn-group dropdown">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        <i class="fas fa-home"></i>Filtre
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="admin.php?action=allPosts">
                            Toutes les publicités
                        </a>
                        {% for data in adSets %}
                            <a class="dropdown-item" href="admin.php">
                                {{ data.adset_name }}
                            </a>
                        {% endfor %}
                    </div>
                </div>
                <table class="container table table-striped table-condensed">
                    <thead>
                    <tr>
                        <th>
                            <i class="far fa-calendar-alt"></i>
                            <span class="responsive_title">Nom de la publicité</span>
                        </th>

                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Dépenses pub</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">CPM</span>
                        </th>
                        <th>
                            <i class="far fa-calendar-alt"></i>
                            <span class="responsive_title">Nombre de clics</span>
                        </th>

                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Coût par clic</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">Résultats</span>
                        </th>
                        <th>
                            <i class="far fa-newspaper"></i>
                            <span class="responsive_title">Coût par résultat</span>
                        </th>
                        <th>
                            <i class="far fa-comment-alt"></i>
                            <span class="responsive_title">Taux d'achat</span>
                        </th>
                    </tr>
                    </thead>


                    <?php
                    foreach ($adSets as $iterAdSet):
                        foreach ($allAds[$iterAdSet['adset_id']] as $ad): ?>


                    {% for iterAdSet in adSets %}
                        {% for ad in allAds[iterAdSet.adset_id] %}
                            <tr class="{{ iterAdSet.adset_name }}">
                                <td>
                                    {{ iterAdSet.adset_name }}
                                    {{ ad.ad_name }}
                                </td>
                                <td>
                                    {{ ad.spend30d }} €
                                </td>
                                <td>
                                    <?= $ad['cpm30d']; ?>
                                    {{ ad.cpm30d }}
                                </td>
                                <td>
                                    <?= $ad['clicks30d']; ?>
                                    {{ ad.clicks30d }}
                                </td>
                                <td>
                                    <?= $ad['cost_per_click30d']; ?>
                                    {{ ad.cost_per_click30d }} €

                                </td>
                                <td>
                                    {{ ad.leads30d }} <br/>
                                    {{ ad.optimization_goal }}
                                </td>
                                <td>
                                    {{ ad.cost_per_lead30d }} €
                                </td>
                                <td>
                                    {{ ad.sell_rate30d }}
                                </td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                    <?php endforeach;
                    endforeach; ?>
                </table>
            </div>
            <a class="exportButton" href="">Export des données</a>

        </section>
    </div>
    </div>
{% endblock %}

{% block scripts %}
{#    {% if datesSpend and valuesSpend %}#}
        <script>
            var filterAds = new FilterAds();

                    {#var url = "{{ SERVER_NAME }}/admin.php?action=testAJAX&account_id={{ accountId }}"#}

                    {#var app = new App(url);#}
                    {#app.init();#}
                    {#app.plotSpend('plotSpend');#}
                    {#app.plotLead('plotLead');#}
                    {#app.plotCostPerLead('plotCostPerLead');#}
        </script>
{#    {% endif %}#}

{% endblock %}
